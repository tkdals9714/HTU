<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="sec"
	uri="http://www.springframework.org/security/tags"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<style>
.content {
	background-color: #ffffff;
}

.profile_wrap {
	width: 55%;
	margin: 20px;
	padding: 20px;
	border: 1px solid #dddddd;
	border-radius: 10px;
	box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
	margin: 20px;
}

.table_topic {
	font-size: 24px;
	font-weight: bold;
	padding-bottom: 20px;
	display: flex;
	margin-left: 10px;
	position: relative;
}

.info-icon {
	font-size: 24px;
	position: absolute;
	left: 9.5%;
}

.profile_photo_wrap {
	display: flex;
	align-items: center;
	margin-top: 20px;
	margin-bottom: 20px;
}

.profile_photo {
	width: 160px;
	height: 160px;
	overflow: hidden;
	margin-right: 20px;
	border: 2px solid #000000;
}

.profile_photo img {
	width: 100%;
	height: 100%;
	object-fit: cover;
}

.upload_form {
	display: flex;
	flex-direction: column;
	margin-top: 20px;
}

.upload_form input {
	margin-bottom: 10px;
	width: 100%;
}

.upload_form button {
	padding: 10px;
	background-color: #4caf50;
	color: #ffffff;
	border: none;
	cursor: pointer;
}

.profile_wrap table {
	width: 100%;
	border-collapse: collapse;
	margin-top: 20px;
	border-radius: 10px; /* 모서리를 곡선으로 만듭니다. */
	overflow: hidden;
}

.profile_wrap th, .profile_wrap td {
	border: 1px solid #dddddd;
	padding: 10px;
	text-align: left;
}

.profile_wrap th {
	width: 170px;
	font-size: 14px;
	font-weight: bold;
	background-color: #f2f2f2; /* th 배경색 추가 */
}

.profile_wrap td {
	padding: 15px;
	font-weight: bold;
}

/* 수정 가능한 입력 폼 스타일 추가 */
.edit_form {
	border: 1px solid #ddd; /* 테두리 추가 */
	background-color: #f9f9f9; /* 배경색 추가 */
	border-radius: 5px;
	padding: 5px;
}

.logo {
	width: 19%;
	height: 28%;
	position: absolute;
	left: 37%;
	top: 3%;
}
</style>

<sec:authentication property="principal.userVO" var="userVO" />
<div class="profile_wrap">
	<div class="table_topic">
		정보수정 <i class="fa-solid fa-circle-info" style="margin-left: 6px;"></i>
	</div>

	<div class="profile_photo_wrap">
		<div class="profile_photo">
			<img src="/resources/upload/${data[0].filesDetailVO.fileSvnm}"
				alt="Profile Photo">
		</div>
		<img src="/resources/images/logo_circle.png" alt="Logo" class="logo">
	</div>

	<form id="profileEditForm" action="/common/mypage/profileEditPost"
		method="post">
		<input type="text" id="userCd" name="userCd" value="${userVO.userCd}" style="display:none;">
		<table>
			<tr>
				<th>학번</th>
				<td>${userVO.userCd}</td>
			</tr>
			<tr>
				<th>이름(영문)</th>
				<td>${userVO.userNm}(${userVO.userNme})</td>
			</tr>
			<tr>
				<th>주민등록번호</th>
				<td>${userVO.userReg1}-(${userVO.userReg2})</td>
			</tr>
			<tr>
				<th>전화번호</th>
				<td><input type="text" id="userTel" name="userTel"
					style="font-size: 17px;" value="${userVO.userTel}"></td>
			</tr>
			<tr>
				<th>주소</th>
				<td>
					<input type="text" id="userAddr1" name="userAddr1" value="${userVO.userAddr1}"> 
					<input type="text" id="userAddr2" name="userAddr2" style="font-size: 17px;" value="${userVO.userAddr2}"> 
				</td>
			</tr>
			<tr>
				<th>이메일</th>
				<td><input type="text" id="userMail" name="userMail"
					style="font-size: 17px;" value="${userVO.userMail}"></td>
			</tr>
			<tr>
				<th>계좌</th>
				<td><input type="text" id="userBank" name="userBank"
					value="${userVO.userBank}"> <input type="text" id="userAcc"
					name="userAcc" style="font-size: 17px;" value="${userVO.userAcc}">
				</td>
			</tr>
		</table>
		<button id="profileCancel" class="btn-two mini orange" style="position: relative; left: 85%; top: 9px;">취소</button>
        <button type="button" id="profileEditSubmit" class="btn-two mini blue" style="position: relative; left: 83%; top: 9px;">수정</button>
    </form>
</div>

<script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
<script>
    $(document).ready(function () {
        $("#profileEditSubmit").click(function () {
            // CSRF 토큰 가져오기
            var csrfToken = $("meta[name='_csrf']").attr("content");
            var csrfHeader = $("meta[name='_csrf_header']").attr("content");
            var userCd = $("#userCd").val();
            console.log(userCd)
            
            // AJAX 요청 설정
            $.ajax({
                type: "POST",
                url: "/common/mypage/profileEditPost",
                data: $("#profileEditForm").serialize(),
                // 폼 데이터 직렬화
                beforeSend: function (xhr) {
                    // CSRF 토큰을 헤더에 포함시키기
                    xhr.setRequestHeader(csrfHeader, csrfToken);
                },
                success: function (data) {
                    // 성공 시 동작
                    console.log("Success:", data);
                    alert("수정이 완료되었습니다.")
                 
                    
                },
              
            });
        });
    });
</script>
