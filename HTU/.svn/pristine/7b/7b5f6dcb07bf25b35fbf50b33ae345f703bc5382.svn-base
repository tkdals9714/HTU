<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags" %>

<style>
	.enrolment_box{width:100%;}
	.enrolment_box .table_topic{font-size: 20px; padding-bottom:30px;}
	.enrolment_box .table_topic i{margin-left:10px;}
	.enrolment_box table{font-size:14px; width:100%; text-align:center;}
	.table_title{font-size:13px; border-top:1px solid #d1d0d0; border-bottom:1px solid #d1d0d0; height:32px; line-height:32px;}
	.enrolment_box tr{}
.enlist_box{
	border: 2px solid #751c35;;
    display: flex;
    gap: 10px;
    padding: 32px;
    justify-content: space-around;
    background-color: #f6f0f1;
    border-radius: 16px;
}

input {
	width: 150px;
	border: 1px solid #751c35;
	border-radius: 6px;
	font-size: 16px;
}

.enlist_content {
	display: flex;
    flex-direction: column;
    gap: 40px;
}

.table_topic {
	font-weight: bolder;
}
select{
	border: 1px solid #751c35;
	border-radius: 6px;
	width: 350px;
}

.enlist_innerbox{
	display: flex; 
	align-items: center;
}

.enlist_label {
	width: 80px;
    display: flex;
    justify-content: flex-end;
    margin-right: 8px;
}

table {
  width: 50%;
  border-collapse: collapse;
  margin-top: 20px;
}
th, td {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}
th {
  background-color: #f2f2f2;
}
</style>

<sec:authentication property="principal.userVO" var="userVO"/>
<div class="enrolment_box">
	<input type="text" id="jsonLecture" value='${jsonLecture}' style="display: none;">
	<input type="text" id="jsonUser" value='${jsonUser}' style="display: none;">
	<div class="table_topic">수강신청<i class="fa-solid fa-circle-info" style="color: #333333;"></i></div>
	<div class="enlist_content">
		<div class="enlist_box" >
			<div>소속대학
				<input type="text" value="${creditVO.colNm}" readonly>
			</div>
			<div>학과
				<input type="text"  value="${userVO.studentVO.departmentVO.depNm}" readonly>
			</div>
			<div>기준학점
				<input type="number" value="${creditVO.stdCredit}" readonly>
			</div>
			<div>신청가능학점
				<input type="number" value="${creditVO.stdCredit}" readonly>
			</div>
			<div>학년
				<input type="text"  value="${userVO.studentVO.stuYear}학년 ${userVO.studentVO.stuSem}학기" readonly>
			</div>
		</div>
		
		<div class="enlist_box" style="flex-direction: column;">
			<div style="display: flex; justify-content: flex-start; gap: 8px;">
				<div class="enlist_innerbox"><div class="enlist_label">년도</div>
					<select>
						<option value="2022">2022</option>
						<option value="2023">2023</option>
						<option value="2024" selected>2024</option>
					</select>
				</div>
				<div class="enlist_innerbox"><div class="enlist_label">학기</div>
					<select>
						<option value="1">1학기</option>
						<option value="2">2학기</option>
					</select>
				</div>
				<div class="enlist_innerbox"><div class="enlist_label">학과전공</div>
					<select>
						<option>2022</option>
						<option>2023</option>
						<option>2024</option>
					</select>
				</div>
			</div>
			<div class="mt-4" style="display: flex; justify-content: flex-start; gap: 8px;">
				<div class="enlist_innerbox"><div class="enlist_label">이수구분</div>
					<select>
						<option value="0">전공필수</option>
						<option value="1">전공선택</option>
						<option value="2">교양필수</option>
						<option value="3">교양선택</option>
					</select>
				</div>
				<div class="enlist_innerbox" style=" margin-right: 150px;"><div class="enlist_label">과목명</div>
					<input type="text" style="width: 500px;">
					<button class="btn-two green mini">검색</button>
				</div>
			</div>
		</div>
	</div>
	
	<table style="margin-top: 30px;">
		<tr class="table_title">
			<td>관심강의등록</td>
			<td>개설학과</td>
			<td>학년</td>
			<td>과목명</td>
			<td>수강정원</td>
			<td>수강인원</td>
			<td>개설이수구분</td>
			<td>학점</td>
			<td>강의시간/강의실</td>
			<td>담당교수</td>
			<td>성적평가방식</td>
			<td>강의계획서</td>
		</tr>
		<c:forEach items="${lectureList}" var="vo">
			<tr>
				<td>
					<c:set value="true" var="flag"/>
					<c:forEach items="${vo.wishLectureList}" var="wishLectureVO">
						<c:if test="${flag and wishLectureVO.stuCd eq userVO.userCd}">
							<button class="btn-two mini dark removeWishBtn" data-lec-cd="${vo.lecCd}">관심강의</button>
							<c:set value="false" var="flag"/>
						</c:if>
					</c:forEach>
					<c:if test="${flag}">
						<button class="btn-two mini green addWishBtn" data-lec-cd="${vo.lecCd}">관심강의추가</button>
					</c:if>
				</td>
				<td>${vo.lectureApplyVO.departmentVO.depNm}</td>
				<td>${vo.lectureApplyVO.lecaTrg}</td>
				<td>${vo.lectureApplyVO.lecaNm}</td>
				<td>${vo.lecHcnt}</td>
				<td>${vo.lectureApplyVO.lecaCap}</td>
				<td>
					<c:choose>
						<c:when test="${vo.lectureApplyVO.lecaType eq 0}">
							전공필수
						</c:when>
						<c:when test="${vo.lectureApplyVO.lecaType eq 1}">
							전공선택
						</c:when>
						<c:when test="${vo.lectureApplyVO.lecaType eq 2}">
							교양필수
						</c:when>
						<c:when test="${vo.lectureApplyVO.lecaType eq 3}">
							교양선택
						</c:when>
					</c:choose>
				</td>
				<td>${vo.lectureApplyVO.lecaCrd}</td>
				<td>${vo.lectureApplyVO.lecaSche}   ${vo.lectureApplyVO.lecaStdt} ~ ${vo.lectureApplyVO.lecaEddt}</td>
				<td>${vo.lectureApplyVO.professorVO.userVO.userNm}</td>
				<td>
					<c:choose>
						<c:when test="${vo.lectureApplyVO.lecaEva eq 0}">상대평가</c:when>
						<c:otherwise>절대평가</c:otherwise>
					</c:choose>
				</td>
				<td><button class="btn-two mini orange">바로가기</button></td>
			</tr>
		</c:forEach>
	</table>
	
	<div style="width: 40%;">
		<table>
		  <tr>
		    <th>시간</th>
		    <th>월요일</th>
		    <th>화요일</th>
		    <th>수요일</th>
		    <th>목요일</th>
		    <th>금요일</th>
		  </tr>
		  <tr>
		    <td>08:00 - 09:00</td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <!-- Add more rows for additional courses on Monday to Friday -->
		  </tr>
		  <tr>
		    <td>09:00 - 10:00</td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <td></td>
		  </tr>
		  <tr>
		  	<td>10:00 - 11:00</td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <td></td>
		  </tr>
		  <tr>
		  	<td>11:00 - 12:00</td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <td></td>
		  </tr>
		  <tr>
		  	<td>12:00 - 13:00</td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <td></td>
		  </tr>
		  <tr>
		  	<td>13:00 - 14:00</td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <td></td>
		  </tr>
		  <tr>
		  	<td>14:00 - 15:00</td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <td></td>
		  </tr>
		  <tr>
		  	<td>15:00 - 16:00</td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <td></td>
		  </tr>
		  <tr>
		  	<td>16:00 - 17:00</td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <td></td>
		  </tr>
		  <tr>
		  	<td>17:00 - 18:00</td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <td></td>
		    <td></td>
		  </tr>
		</table>
	</div>
	
	
	
</div>

<script>
	
	const jsonLecture = JSON.parse($("#jsonLecture").val());
	console.log(jsonLecture);
	const jsonUser = JSON.parse($("#jsonUser").val());
	console.log(jsonUser);
	const userCd = jsonUser.userCd;
	
	
	$(document).on("click", ".addWishBtn", function() {
		
		const lecCd = $(this).data("lecCd");
		
		console.log(lecCd, userCd);
		
		$.ajax({
			url: "/student/enrolment/addWishLecture",
			contentType: "application/json; charset=UTF-8",
			data: JSON.stringify({lecCd: lecCd, stuCd: userCd}),
			type: "post",
			beforeSend:function(xhr){
				xhr.setRequestHeader("${_csrf.headerName}","${_csrf.token}");
			},
			success: res => {
				if (res == 1) {
					$(this).parent().html(`<button class="btn-two mini dark removeWishBtn" data-lec-cd="\${lecCd}">관심강의</button>`);
				}
			}
		})
	});
	
	$(document).on("click", ".removeWishBtn", function() {
		
		const lecCd = $(this).data("lecCd");
		
		console.log(lecCd, userCd);
		
		$.ajax({
			url: "/student/enrolment/removeWishLecture",
			contentType: "application/json; charset=UTF-8",
			data: JSON.stringify({lecCd: lecCd, stuCd: userCd}),
			type: "post",
			beforeSend:function(xhr){
				xhr.setRequestHeader("${_csrf.headerName}","${_csrf.token}");
			},
			success: res => {
				if (res == 1) {
					$(this).parent().html(`<button class="btn-two mini green addWishBtn" data-lec-cd="\${lecCd}">관심강의추가</button>`);
				}
			}
		})
		
	})

</script>