<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags" %>
<script src="/resources/js/jquery.min.js"></script>


<link rel="stylesheet" href="/resources/css/bootstrap.min.css">

<div class="container mb-5">
  <h3 class="text-lg-center">시설 예약 현황</h3>
</div>
<div class="container">
  <div class="row">
    <div class="col-md-3">
      <select class="form-select form-select-sm" id="building">
        <option value="">예약 건물 선택</option>
        <c:forEach items="${buldCommonList}" var="vo">
          <option value="${vo.comdCd}">${vo.comdNm}</option>
        </c:forEach>
      </select>
    </div>
    <div class="col-md-1" style="margin-left: 5px;">
      <select class="form-select form-select-sm" id="floor">
        <option value="">층수 선택</option>
      </select>
    </div>
  </div>
  
</div>

<!-- <ul class="nav">
  <li class="nav-item">
    <a class="nav-link active" aria-current="page" href="#">Active</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="#">Link</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="#">Link</a>
  </li>
  <li class="nav-item">
    <a class="nav-link disabled" aria-disabled="true">Disabled</a>
  </li>
</ul> -->


<script>
  
  $("#building").on("change", function(event) {
    const building = $(event.target).val();
    const floorSet = new Set();
    $.ajax({
      url: "/reservation/getListByComdCd?comdCd=" + building,
      type: "get",
      success: res => {
        res.forEach(room => {
          floorSet.add(room.roomCd.substr(6,1))
        })
        console.log(floorSet);
        let txt = '';
        floorSet.forEach((key, value) => {
          txt += `<option value="\${value}">\${value}층</option>`
        })
        $("#floor").html('');
        $("#floor").append('<option value="">층수 선택</option>');
        $("#floor").append(txt);
        
        $("#floor").on("change", function(event) {
          
          const floor = $(event.target).val();
          roomList = [];
          res.forEach(room => {
            if (room.roomCd.substr(6,1) == floor) {
              roomList.push(room);
            }
          });
          console.log(roomList);
        })
      }
    })
  });
  
  
  
</script>







